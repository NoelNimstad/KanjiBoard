!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t){if(null==e)throw new Error(t??"Value failed non-null assertion!");return e}function o(e,t){if(!e)throw new Error(t??"Condition false!")}function r(e){let t=[],n=e,o=[];for(let e=0;e<n.length;e++)switch(n[e][0]){case"m":{let r=n[e].substring(1).split(",");o[0]=parseFloat(r[0]),o[1]=parseFloat(r[1]),t.push([o[0]*s,o[1]*s])}break;case"M":{let r=n[e].substring(1).split(",");o[0]=parseFloat(r[0]),o[1]=parseFloat(r[1]),t.push([o[0]*s,o[1]*s])}break;case"c":{let r=n[e].substring(1).split(",");for(;r.length>2;)r.shift();let i=parseFloat(r[0]),l=parseFloat(r[1]);o[0]+=i,o[1]+=l,t.push([o[0]*s,o[1]*s])}break;case"C":{let r=n[e].substring(1).split(",");for(;r.length>2;)r.shift();o[0]=parseFloat(r[0]),o[1]=parseFloat(r[1]),t.push([o[0]*s,o[1]*s])}break;default:console.log("you messed up")}return t}e.r(t),e.d(t,{SCALE:()=>s,context:()=>c,kb:()=>C});const s=3,i=9*s;let l,a,c,u=!0,d=!1,p={x:0,y:0},h={x:0,y:0},g={x:0,y:0},v={kanji:"木",strokeCount:0,strokes:new Array(new Array(new Array)),currentStroke:0,currentPoint:0,svgPaths:new Array},k={x:0,y:0};const y=()=>{let e=l.getBoundingClientRect();k.x=e.x,k.y=e.y},f=e=>({x:e.x-k.x,y:e.y-k.y});let w,b,m,x=!1,S=()=>{};function E(e){x=!0,a.innerHTML+=e?v.svgPaths[v.currentStroke++]?.replace("h ",`h stroke="${e}" `):v.svgPaths[v.currentStroke++],d=!1}function M(){return v.currentStroke===v.strokeCount}const P=new ResizeObserver(e=>{for(const t of e)if(t.target===l||t.target===l.parentElement){y();break}});window.addEventListener("scroll",y,{passive:!0});const C={initialise:async function(e){const t=document.createElement("div");t.style.position="relative",t.style.width=(109*s).toString(),t.style.height=(109*s).toString(),e.append(t);const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("width",(109*s).toString()),o.setAttribute("height",(109*s).toString()),o.setAttributeNS(null,"viewBox","0 0 109 109"),o.style.position="absolute",o.style.backgroundImage="url(./box.svg)",o.style.backgroundSize="cover",o.style.pointerEvents="none",o.style.boxSizing="border-box",o.style.zIndex="-1";const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.style="fill:none;stroke:#000000;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;",a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("kvg:element","木"),a.setAttribute("kvg:radical","general"),l=document.createElement("canvas"),l.width=109*s,l.height=109*s,t.append(l),l.style.imageRendering="cris-edges",l.style.position="absolute",l.style.zIndex="1",l.style.touchAction="none",r.append(a),o.append(r),t.append(o),c=n(l.getContext("2d")),c.strokeStyle="black",c.lineWidth=2.5*s,c.lineCap="round",l.addEventListener("mousedown",e=>{if(d||v.currentStroke>=v.strokeCount)return;const t=f(e);p.x=g.x=h.x=t.x,p.y=g.y=h.y=t.y,d=!0,x=!1,v.currentPoint=0,console.clear(),console.debug("Started drawing")}),l.addEventListener("mouseup",()=>{d&&(d=!1,c.clearRect(0,0,l.width,l.height),x||b(),console.debug("Stopped drawing"))}),l.addEventListener("mousemove",e=>{if(d){if(p.x=p.x+1*(g.x-p.x),p.y=p.y+1*(g.y-p.y),h=f(e),Math.abs(h.x-v.strokes[v.currentStroke][v.currentPoint][0])<=i&&Math.abs(h.y-v.strokes[v.currentStroke][v.currentPoint][1])<=i&&(console.log(`Point ${v.currentPoint++} cleared!`),v.currentPoint===v.strokes[v.currentStroke].length))return console.log(`Stroke ${v.currentStroke} cleared!`),E(),S(),c.clearRect(0,0,l.width,l.height),void(v.currentStroke===v.strokeCount&&w());g.x=g.x+1*(h.x-g.x),g.y=g.y+1*(h.y-g.y),c.strokeStyle="black",c.beginPath(),c.moveTo(p.x,p.y),c.lineTo(g.x,g.y),c.stroke()}}),l.addEventListener("touchstart",e=>{let t=e.touches[0];if(void 0===t){let e=new MouseEvent("mousedown",{clientX:h.x,clientY:h.y});return void l.dispatchEvent(e)}let n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});l.dispatchEvent(n)}),l.addEventListener("touchmove",e=>{let t=e.touches[0];if(void 0===t){let e=new MouseEvent("mousemove",{clientX:h.x,clientY:h.y});return void l.dispatchEvent(e)}let n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});l.dispatchEvent(n)}),l.addEventListener("touchend",e=>{let t=e.touches[0];if(void 0===t){let e=new MouseEvent("mouseup",{clientX:h.x,clientY:h.y});return void l.dispatchEvent(e)}let n=new MouseEvent("mouseup",{clientX:t.clientX,clientY:t.clientY});l.dispatchEvent(n)}),P.observe(l),l.parentElement&&P.observe(l.parentElement),y()},load:async function(e){v.kanji=e,v.currentPoint=v.currentStroke=0;const t=await async function(e){o(1===e.length,"More than 1 character supplied!");const t=await fetch(`https://kanjivg.tagaini.net/kanjivg/kanji/${e.charCodeAt(0).toString(16).padStart(5,"0")}.svg`);return function(e,t){const s=n(e.match(/(<path(.*))/g));let i=[];for(let e of s){let t=[];const s=n(e.replace(/(.*)[Mm](.*?),(.*?)c(.*)/g,"$2:$3").split(":"));o(s.length>=2,"Insufficient data points!"),t.push([parseFloat(s[0]),parseFloat(s[1])]);let l=e.replace(/(.*)d="(.*)"(.*)/,"$2").replace(/(?<!,)-/g,",-").replace(/([mMcC])/g,":$1").split(":");l.shift(),i.push(r(l))}return{kanji:t,strokeCount:i.length,strokes:i,svgPaths:s}}(await t.text(),e)}(v.kanji);v.strokes=n(t.strokes,"No strokes found!"),o(v.strokes.length>0,"No strokes found!"),v.strokeCount=t.strokeCount,v.svgPaths=t.svgPaths,a.innerHTML="",c.clearRect(0,0,l.width,l.height),m()},isComplete:M,setOnReady:function(e){m=e},setOnStroke:function(e){S=e},setOnComplete:function(e){w=e},setOnMistake:function(e){b=e},ghostNextStroke:function(e="rgba(0, 0, 0, 0.2)"){u=!0,a.innerHTML+=v.svgPaths[v.currentStroke]?.replace("h ",`h stroke="${e}" `)},clearGhosts:function(){u&&(u=!1,a.innerHTML=a.innerHTML.replace(/<path stroke=(.*?)\/path>/g,""))},revealNextStroke:E,revealAllStrokes:function(e){for(;!M();)E(e)}};return window.kb=C,t})());